Scrollator={scrollatorElementsStack:[],refreshAll:function(){for(var o=Scrollator.scrollatorElementsStack.length;o--;)!Scrollator.scrollatorElementsStack[o].$sourceElement.closest("body").length>0?Scrollator.scrollatorElementsStack[o].destroy():Scrollator.scrollatorElementsStack[o].refresh()}},$(window).load(function(){Scrollator.refreshAll()}),function(o){o.scrollator=function(e,t){var l={custom_class:"",prevent_propagation:!1,zIndex:""},r=this;r.settings={};var n=o("html"),i=o(e);r.$sourceElement=i;var s=null,a=null,d=null,c=null,u=null,h=null,w=!1,m=0,p=0,g=0;r.init=function(){r.settings=o.extend({},l,t),s=o("#scrollator_holder"),i.addClass("scrollator"),a=o(document.createElement("div")).addClass("scrollator_lane_holder"),a.addClass(r.settings.custom_class),a.css("z-index",i.css("z-index")),""!==r.settings.zIndex&&a.css("z-index",r.settings.zIndex),i.is("body")&&a.addClass("scrollator_on_body"),d=o(document.createElement("div")).addClass("scrollator_lane"),c=o(document.createElement("div")).addClass("scrollator_handle_holder"),u=o(document.createElement("div")).addClass("scrollator_handle"),M(),"BODY"==i.prop("tagName")?(n.bind("mousewheel DOMMouseScroll",v),n.bind("mousemove",b)):(i.bind("mousewheel DOMMouseScroll",v),i.bind("mousemove",b)),a.bind("mousewheel DOMMouseScroll",v),d.bind("mousewheel DOMMouseScroll",v),c.bind("mousewheel DOMMouseScroll",v),u.bind("mousewheel DOMMouseScroll",v),a.bind("mousemove",b),d.bind("mousemove",b),c.bind("mousemove",b),u.bind("mousemove",b),c.bind("mousedown",f),u.bind("mousedown",f),o(window).bind("mouseup",S),o(window).bind("mousemove",y),o(window).bind("keydown",E),c.append(u),d.append(c),a.append(d),s.append(a),D(),document.body.hasScrollatorPageResizeEventHandler||(document.body.hasScrollatorPageResizeEventHandler=!0,o(window).bind("resize",function(){Scrollator.refreshAll()})),b()};var v=function(e){if(!e.ctrlKey&&("auto"!=o(e.target).css("overflow-y")||"fixed"==o(e.target).css("position")||"PRE"==o(e.target).prop("tagName"))){var t=(i.is("body")?o(window):i).scrollTop(),l=t,n=0;void 0!==e.originalEvent.wheelDeltaY&&0!==e.originalEvent.wheelDeltaY?n=e.originalEvent.wheelDeltaY/1.2:void 0!==e.originalEvent.wheelDelta&&0!==e.originalEvent.wheelDelta?n=e.originalEvent.wheelDelta/1.2:void 0!==e.originalEvent.detail&&0!==e.originalEvent.detail&&(n=-33.33*e.originalEvent.detail),t+=-1*n,(i.is("body")?o(window):i).scrollTop(t),t=(i.is("body")?o(window):i).scrollTop(),Scrollator.refreshAll(),(l!=t||r.settings.prevent_propagation)&&(e.preventDefault(),e.stopPropagation())}},b=function(){clearTimeout(h),i[0].scrollHeight>(i.is("body")?o(window).height():i.innerHeight())?(a.css("opacity",1),h=setTimeout(function(){a.css("opacity",0)},1500)):a.css("opacity",0)},f=function(e){e.preventDefault(),w=!0,m=e.clientY,p=(i.is("body")?o(window):i).scrollTop(),g=e.offsetY,a.addClass("hover")},y=function(e){if(w){var t=e.clientY-m,l=i[0].scrollHeight/(i.is("body")?o(window).height():i.innerHeight());(i.is("body")?o(window):i).scrollTop(p+t*l),Scrollator.refreshAll(),b()}},S=function(){w=!1,a.removeClass("hover")},E=function(e){var t={pageUp:33,pageDown:34};if((e.keyCode==t.pageUp||e.keyCode==t.pageDown)&&"TEXTAREA"!=o(document.activeElement).prop("tagName")){var l=(i.is("body")?o(window):i).scrollTop(),r=.9*(i.is("body")?o(window).height():i.innerHeight());e.keyCode==t.pageUp?l-=r:e.keyCode==t.pageDown&&(l+=r),(i.is("body")?o(window):i).scrollTop(l),Scrollator.refreshAll(),b()}};r.refresh=function(){D()};var D=function(){var e=i[0].getBoundingClientRect(),t={left:e.left+o(window).scrollLeft(),top:e.top+o(window).scrollTop(),right:e.right+o(window).scrollLeft(),bottom:e.bottom+o(window).scrollTop(),width:e.width,height:e.height},l=parseInt(i.css("border-top-width"),10),r=parseInt(i.css("border-right-width"),10),n=parseInt(i.css("border-bottom-width"),10),s=(parseInt(i.css("border-left-width"),10),i[0].scrollHeight),d=i.is("body")?o(window).height():i.innerHeight(),u=d/s*100,h=(i.is("body")?o(window):i).scrollTop()/s*100;i.is("body")||a.css({top:t.top+l,right:-t.right+r,bottom:-t.bottom+n}),c.css({height:u+"%",top:h+"%"})},M=function(){0===s.length&&(s=o(document.createElement("div")).attr("id","scrollator_holder"),o("body").append(s))};r.hide=function(){a.hide()},r.show=function(){a.show()},r.destroy=function(){i.removeClass("scrollator"),o.removeData(e,"scrollator"),"BODY"==i.prop("tagName")?(n.unbind("mousewheel DOMMouseScroll",v),n.unbind("mousemove",b)):(i.unbind("mousewheel DOMMouseScroll",v),i.unbind("mousemove",b)),o(window).unbind("mouseup",S),o(window).unbind("mousemove",y),o(window).unbind("keydown",E),a.remove();for(var t=Scrollator.scrollatorElementsStack.length;t--;)Scrollator.scrollatorElementsStack[t]===r&&Scrollator.scrollatorElementsStack.splice(t,1);0===s.children().length&&(s.remove(),s=null)},r.init()},o.fn.scrollator=function(e){return e=void 0!==e?e:{},this.each(function(){if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|ARM|Touch|Opera Mini/i.test(navigator.userAgent))if("object"==typeof e){if(void 0===o(this).data("scrollator")){var t=new o.scrollator(this,e);Scrollator.scrollatorElementsStack.push(t),o(this).data("scrollator",t)}}else o(this).data("scrollator")[e]?o(this).data("scrollator")[e].apply(this,Array.prototype.slice.call(arguments,1)):o.error("Method "+e+" does not exist in $.scrollator")})}}(jQuery);